name: pocketcoder_workspace
publish_to: none

environment:
  sdk: '>=3.5.0 <4.0.0'

workspace:
  - packages/pocketcoder_flutter
  - packages/app
  - packages/flutter_aeroform
  - apps/app

dev_dependencies:
  melos: ^7.4.0

melos:
  name: pocketcoder_workspace
  
  scripts:
    build_all:
      run: melos run build_gen --no-select
      description: Run build_runner for all packages.
    
    build_gen:
      run: flutter pub run build_runner build --delete-conflicting-outputs
      exec:
        concurrency: 1
      packageFilters:
        dependsOn: build_runner

    build_app:
      run: |
        cd apps/app && flutter build apk --debug
      description: Build the PocketCoder Mobile app.

    run_app:
      run: |
        cd apps/app && flutter run
      description: Run the PocketCoder Mobile app.

    run_incognito:
      run: |
        cd apps/app && flutter run -d chrome --web-browser-flag="--incognito"
      description: Run the app in Chrome Incognito mode.

    check:purity:
      run: ./scripts/purity_check.sh pocketcoder_flutter
      description: Verify that the core package has no proprietary dependencies.
    
    test:
      run: melos exec -- "flutter test"
      description: Run tests in all packages.

    fix:
      run: melos exec -- "dart fix --apply"
      description: Apply dart fixes to all packages.
