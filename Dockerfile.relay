FROM node:20-slim

WORKDIR /app

# Copy dependency manifests
COPY relay/package.json ./

# Install dependencies
RUN npm install

# Copy the relay scripts
COPY relay/chat_relay.mjs ./
COPY relay/sync_ssh_keys.mjs ./
COPY relay/start.sh ./

# Make scripts executable
RUN chmod +x ./chat_relay.mjs ./sync_ssh_keys.mjs ./start.sh

# Run the startup script with bash
CMD ["/bin/bash", "./start.sh"]
