FROM node:lts-slim

# Install Python and system dependencies for CAO
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Install uv (Python package manager)
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/root/.local/bin:$PATH"

# Install OpenCode
RUN npm install -g opencode-ai@latest

# Copy CAO source (for MCP server)
COPY sandbox/cao /app/cao

# Install CAO dependencies
RUN cd /app/cao && uv sync

# Set the working directory
WORKDIR /app

# The command will be overridden by docker-compose or entrypoint, 
# but defaulting to opencode is good practice.
ENTRYPOINT ["opencode"]
